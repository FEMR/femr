@(currentUser: femr.common.dtos.CurrentUser, viewModel: femr.ui.models.history.IndexEncounterViewModel, viewModelMedical: femr.ui.models.history.IndexEncounterMedicalViewModel, viewModelPharmacy: femr.ui.models.history.IndexEncounterPharmacyViewModel)


@import femr.ui.views.html.layouts.main
@import femr.ui.views.html.partials.helpers.outputFloatOrNA
@import femr.ui.views.html.partials.helpers.outputStringOrNA
@import femr.ui.views.html.partials.helpers.outputIntOrNA
@import femr.ui.views.html.partials.helpers.outputHeightOrNA
@import femr.ui.views.html.partials.helpers.outputBloodPressureOrNA
@import collection.JavaConversions._
@import femr.ui.views.html.partials.triage._




@additionalScripts = {
    <script type="text/javascript" src="@routes.Assets.at("js/history/history.js")" xmlns="http://www.w3.org/1999/html"></script>

    }
    @additionalStyles = {
        <link rel="stylesheet" href="@routes.Assets.at("css/history.css")">
        <link rel="stylesheet" href="@routes.Assets.at("css/libraries/datepicker.css")">

    }


@main("History", currentUser, scripts = additionalScripts, styles = additionalStyles) {
    <div class="sectionBackground backgroundForWrap" id="encounterViewWrap">
        <div id="encounterViewHeader">

            <div class="submit">
                <button type="submit" id="historySaveBtn" class="fButton fRedButton fSubmitButton pull-right">
                    Save</button>
            </div>

            <a href="/history/encounter/@viewModel.getPatientItem.getId" class="btn btn-default pull-right">Save </a>

            <img class="" height="90" width="90" src="@viewModel.getPatientItem.getPathToPhoto" />
            <p>@viewModel.getPatientItem.getFirstName @viewModel.getPatientItem.getLastName
                (@viewModel.getPatientItem.getId)</p>

        </div>

        <div class="encounterViewBodyHeader">
            <p>Basic Information and Vitals</p>
        </div>
        <div class="encounterViewBody">
            <div class="encounterViewBodyLeft">
            @defining(viewModel.getPatientItem) { patient =>
                <div class="encounterViewBodyLeftHalf">

                    <p><span class="infoLabel">First Name:</span> @outputStringOrNA(patient.getFirstName)</p>
                    <p><span class="infoLabel">Last Name:</span> @outputStringOrNA(patient.getLastName)</p>
                    <p><span class="infoLabel">Address:</span> @outputStringOrNA(patient.getAddress)</p>
                    <p><span class="infoLabel">Birthday:</span> @outputStringOrNA(patient.getFriendlyDateOfBirth)</p>
                    <p><span class="infoLabel">Age:</span> @outputStringOrNA(patient.getAge)</p>
                    <p><span class="infoLabel">Gender:</span> @outputStringOrNA(patient.getSex)</p>
                </div>
                <div class="encounterViewBodyLeftHalf">
                    <p><span class="infoLabel">Pregnancy Status:</span> @outputIntOrNA(patient.getWeeksPregnant)</p>
                    <p><span class="infoLabel">
                        Height:</span> @outputHeightOrNA(patient.getHeightFeet, patient.getHeightInches)</p>
                    <p><span class="infoLabel">Weight:</span> @outputFloatOrNA(patient.getWeight)</p>
                </div>
            }
            </div>
            <div class="encounterViewBodyMiddle">
            @defining(viewModel.getPatientEncounterItem) { encounter =>
                <p><span class="infoLabel">Triage Visit:</span> @encounter.getTriageDateOfVisit</p>
                <p><span class="infoLabel">Nurse:</span> @encounter.getNurseEmailAddress</p>
                <br>
                <p><span class="infoLabel">Medical Visit:</span> @encounter.getMedicalDateOfVisit</p>
                <p><span class="infoLabel">Physician:</span> @encounter.getPhysicianEmailAddress</p>
                <br>
                <p><span class="infoLabel">Pharmacy Visit:</span> @encounter.getPharmacyDateOfVisit</p>
                <p><span class="infoLabel">Pharmacist:</span> @encounter.getPharmacistEmailAddress</p>

            }
            </div>

            <div class="encounterViewBodyRight">
            @defining(viewModelMedical.getVitalList) { vitalMap =>
                <p>
                    <span class="infoLabel">Temperature:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputStringOrNA(vitalMap.get("temperature", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                    </p>
                <p>
                    <span class="infoLabel">Blood Pressure:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputBloodPressureOrNA(vitalMap.get("bloodPressureSystolic", vitalMap.getDate(dateIndex - 1)), vitalMap.get("bloodPressureDiastolic", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                </p>
                <p>
                    <span class="infoLabel">Heart Rate:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputStringOrNA(vitalMap.get("heartRate", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                </p>
                <p>
                    <span class="infoLabel">Respiration Rate:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputStringOrNA(vitalMap.get("respiratoryRate", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                </p>
                <p>
                    <span class="infoLabel">Oxygen Saturation:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputStringOrNA(vitalMap.get("oxygenSaturation", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                </p>
                <p>
                    <span class="infoLabel">Glucose:</span>
                    @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                        <span>
                        @outputStringOrNA(vitalMap.get("glucose", vitalMap.getDate(dateIndex - 1)))
                        </span>
                    }
                </p>
            }
            </div>
        </div>


        <div class="encounterViewBodyHeader">
            <p>Assessment</p>
        </div>
        <div class="encounterViewBody">
            <div class="encounterViewBodyLeft">





                @*Pmh and treatment tab fields are listed here*@
                @defining(viewModelMedical.getPmhFields) { pmhFieldMap =>



                    <label class="inputLabel">Medical/Surgical History:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "MedicalSurgicalHistory" name="MedicalSurgical History" value="@outputStringOrNA(pmhFieldMap.get("medicalSurgicalHistory"))" />

                    <label class="inputLabel">Social History:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "SocialHistory" name="SocialHistory" value="@outputStringOrNA(pmhFieldMap.get("socialHistory"))" />

                    <label class="inputLabel">Current Medications:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "CurrentMedications" name="CurrentMedications" value="@outputStringOrNA(pmhFieldMap.get("currentMedications"))" />


                    <label class="inputLabel">Family History:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "FamilyHistory" name="FamilyHistory" value="@outputStringOrNA(pmhFieldMap.get("familyHistory"))" />




                }
                @defining(viewModelMedical.getTreatmentFields) { treatmentFieldMap =>

                       <label class="inputLabel">Assessment:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Assessment" name="Assessment" value="@outputStringOrNA(treatmentFieldMap.get("assessment"))" />

                    <label class="inputLabel">Treatment:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Treatment" name="Treatment" value="@outputStringOrNA(treatmentFieldMap.get("treatment:"))" />



                   @*
                }
                @for(problemIterator <- 1 to viewModelPharmacy.getProblems.size){
                    <p><span class="infoLabel">Diagnosis:</span>@outputStringOrNA(viewModelPharmacy.getProblems.get(problemIterator - 1))</p>
                }
                @for(prescriptionIterator <- 1 to viewModelPharmacy.getPrescriptions.size){
                    <p><span class="infoLabel">Dispensed Medication:</span>@outputStringOrNA(viewModelPharmacy.getPrescriptions.get(prescriptionIterator - 1))</p>
                }

                       *@

            </div>
            <div class="encounterViewBodyMiddle">
            @if(viewModelMedical.isMultipleChiefComplaints) {
                @for((key, value) <- viewModelMedical.getHpiFieldsWithMultipleChiefComplaints) {
                    <h4>Chief Complaint: @key</h4>

                    <label class="inputLabel">Onset:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Onset" name="Onset" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("onset"))" />

                    <label class="inputLabel">Quality:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Quality" name="Quality" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("quality"))" />

                    <label class="inputLabel">Radiation:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Radiation" name="Radiation" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("radiation"))" />

                    <label class="inputLabel">Severity:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Severity" name="Severity" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("severity"))" />



                    <label class="inputLabel">Provokes:</label>
                    <input type="text" class="form-control input-sm pull-left"id= "provokes"  name="Provokes" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("provokes"))" />

                    <label class="inputLabel">Palliates:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Palliates" name="Palliates:" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("palliates"))" />

                    <label class="inputLabel">Time Of Day:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "TimeOfDay" name="TimeOfDay" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("timeOfDay"))" />

                    <label class="inputLabel"> Narrative:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "Narrative" name="Narrative" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("narrative"))" />

                    <label class="inputLabel">Physical Examination:</label>
                    <input type="text" class="form-control input-sm pull-left" id= "PhysicalExamination" name="PhysicalExamination" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("physicalExamination"))" />



                }
            } else {
                @if(viewModel.getPatientEncounterItem.getChiefComplaints != null && viewModel.getPatientEncounterItem.getChiefComplaints.size > 0){<h4>Chief Complaint: @viewModel.getPatientEncounterItem.getChiefComplaints.get(0) </h4>}




                <label class="inputLabel">Onset:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Oneset" name="Onset" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("onset"))" />

                <label class="inputLabel">Quality:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Quality" name="Quality" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("quality"))" />

                <label class="inputLabel">Radiation:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Radiation" name="Radiation" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("radiation"))" />

                <label class="inputLabel">Severity:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Severity" name="Severity" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("severity"))" />



                <label class="inputLabel">Provokes:</label>
                <input type="text" class="form-control input-sm pull-left" id= "PhysicalExamination" name="Provokes" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("provokes"))" />

                <label class="inputLabel">Palliates:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Palliates" name="Palliates" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("palliates"))" />
                <label class="inputLabel">Time Of Day:</label>
                <input type="text" class="form-control input-sm pull-left" id= "TimeOfDay" name="TimeOfDay" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("timeOfDay"))" />

                <label class="inputLabel"> Narrative:</label>
                <input type="text" class="form-control input-sm pull-left" id= "Narrative" name="Narrative" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("narrative"))" />

                <label class="inputLabel">Physical Examination:</label>
                <input type="text" class="form-control input-sm pull-left" id= "PhysicalExamination" name="PhysicalExamination:" value="@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("physicalExamination"))" />



            }


            </div>

            <div class="encounterViewBodyRight">
                @*Custom tab fields are listed here*@
                @for((key, value) <- viewModelMedical.getCustomFields) {
                    <p><span class="infoLabel">
                        @key:
                    </span>
                        @outputStringOrNA(viewModelMedical.getCustomFields.get(key))
                    </p>
                }

            </div>
        </div>

        @if(viewModelMedical.getPhotos.size > 0) {
            <div class="encounterViewBodyHeader">
                <p>Photos</p>
            </div>
            <div class="encounterViewBody">
            @for(x <- 1 to viewModelMedical.getPhotos.size) {
                <img src="@viewModelMedical.getPhoto(x - 1).getImageUrl">
                <p class="imageDescription">@viewModelMedical.getPhoto(x - 1).getImageDesc</p>
            }

            </div>
        }


    </div>

}}




@*
@inputText("First Name", "firstName", true, if(viewModel != null) viewModel.getPatientItem.getFirstName else null, "text")
@inputText("Last Name", "lastName", true, if(viewModel != null) viewModel.getPatientItem.getLastName else null, "text")
@inputText("Address", "address", false, if(viewModel != null) viewModel.getPatientItem.getAddress else null, "text")
@inputText("City", "city", true, if(viewModel != null) viewModel.getPatientItem.getCity else null, "text")
@inputText("Age", "Years", true, if(viewModel != null) viewModel.getPatientItem.getAge else null,"text")
@inputText("Sex", "sex", true, if(viewModel != null) viewModel.getPatientItem.getSex else null,"text")

    *@