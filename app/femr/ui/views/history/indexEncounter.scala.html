@(currentUser: femr.common.dtos.CurrentUser, viewModel: femr.ui.models.history.IndexEncounterViewModel, viewModelMedical: femr.ui.models.history.IndexEncounterMedicalViewModel, viewModelPharmacy: femr.ui.models.history.IndexEncounterPharmacyViewModel)

    @import femr.ui.views.html.layouts.main
    @import femr.ui.views.html.partials.helpers.outputStringOrNA
    @import femr.ui.views.html.partials.helpers.outputIntOrNA
    @import femr.ui.views.html.partials.helpers.outputHeightOrNA
    @import femr.ui.views.html.partials.helpers.outputWeightOrNA
    @import femr.ui.views.html.partials.helpers.outputBloodPressureOrNA
    @import femr.ui.views.html.partials.helpers.outputTemperatureOrNA
    @import collection.JavaConversions._
    @import femr.ui.controllers.routes.PDFConversion


    @additionalScripts = {
        <script type="text/javascript" src="@routes.Assets.at("js/history/history.js")"></script>
    }
    @additionalStyles = {
        <link rel="stylesheet" href="@routes.Assets.at("css/history.css")">
    }


    @main("History", currentUser, scripts = additionalScripts, styles = additionalStyles) {
        <div class="sectionBackground backgroundForWrap" id="encounterViewWrap">
            <div id="encounterViewHeader">


                <a href="/history/edit-encounter/@viewModel.getPatientEncounterItem.getId" class="btn btn-default pull-right">Edit history </a>

                <img class="" height="90" width="90" src="@viewModel.getPatientItem.getPathToPhoto" />
                <p>@viewModel.getPatientItem.getFirstName @viewModel.getPatientItem.getLastName
                    (@viewModel.getPatientItem.getId)</p>
                <div>
                @helper.form(action = PDFConversion.index(viewModel.getPatientItem.getId, viewModel.getPatientEncounterItem.getId)) {  @* Replaced .getID with .getPatientId  *@
                    <button type="submit" id="historyButton" class="fButton fOtherButton pull-right">Generate PDF</button>
                }
                </div>
            </div>

            <div class="encounterViewBodyHeader">
                <p>Basic Information and Vitals</p>
            </div>
            <div class="encounterViewBody">
                <div class="encounterViewBodyLeft">
                @defining(viewModel.getPatientItem) { patient =>
                    <div class="encounterViewBodyLeftHalf">
                        <p><span class="infoLabel">First Name:</span> @outputStringOrNA(patient.getFirstName)</p>
                        <p><span class="infoLabel">Last Name:</span> @outputStringOrNA(patient.getLastName)</p>
                        <p><span class="infoLabel">Address:</span> @outputStringOrNA(patient.getAddress)</p>
                        <p><span class="infoLabel">Birthday:</span> @outputStringOrNA(patient.getFriendlyDateOfBirth)</p>
                        <p><span class="infoLabel">Age:</span> @outputStringOrNA(patient.getAge)</p>
                        <p><span class="infoLabel">Gender:</span> @outputStringOrNA(patient.getSex)</p>
                    </div>
                    <div class="encounterViewBodyLeftHalf">
                        <p><span class="infoLabel">Pregnancy Status:</span> @outputIntOrNA(patient.getWeeksPregnant)</p>

                            <!---  Alaa Serhan - Need to Make Changes Here -->
                        <p><span class="infoLabel">Height:</span> @outputHeightOrNA(
                            String.valueOf(patient.getHeightFeet),
                            String.valueOf(patient.getHeightInches),
                            viewModelMedical.getSettings.isMetric
                        )</p>
                        <p><span class="infoLabel">Weight:</span> @outputWeightOrNA(String.valueOf(patient.getWeight), viewModelMedical.getSettings.isMetric)</p>
                    </div>
                }
                </div>
                <div class="encounterViewBodyMiddle">
                @defining(viewModel.getPatientEncounterItem) { encounter =>
                    <p><span class="infoLabel">Triage Visit:</span> @encounter.getTriageDateOfVisit</p>
                    <p><span class="infoLabel">Nurse:</span> @encounter.getNurseEmailAddress</p>
                    <br>
                    <p><span class="infoLabel">Medical Visit:</span> @encounter.getMedicalDateOfVisit</p>
                    <p><span class="infoLabel">Physician:</span> @encounter.getPhysicianEmailAddress</p>
                    <br>
                    <p><span class="infoLabel">Pharmacy Visit:</span> @encounter.getPharmacyDateOfVisit</p>
                    <p><span class="infoLabel">Pharmacist:</span> @encounter.getPharmacistEmailAddress</p>

                }
                </div>

                <div class="encounterViewBodyRight">
                @defining(viewModelMedical.getVitalList) { vitalMap =>
                    <p>
                        <span class="infoLabel">Temperature:</span>

                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                            @outputTemperatureOrNA(vitalMap.get("temperature", vitalMap.getDate(dateIndex - 1)), viewModelMedical.getSettings.isMetric)
                            </span>
                        }
                        </p>

                    <p>
                        <span class="infoLabel">Blood Pressure:</span>
                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                            @outputBloodPressureOrNA(vitalMap.get("bloodPressureSystolic", vitalMap.getDate(dateIndex - 1)), vitalMap.get("bloodPressureDiastolic", vitalMap.getDate(dateIndex - 1)))
                            </span>
                        }
                    </p>
                    <p>
                        <span class="infoLabel">Heart Rate:</span>
                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                             @outputStringOrNA(vitalMap.get("heartRate", vitalMap.getDate(dateIndex - 1)))
                            </span>
                        }
                    </p>
                    <p>
                        <span class="infoLabel">Respiration Rate:</span>
                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                            @outputStringOrNA(vitalMap.get("respiratoryRate", vitalMap.getDate(dateIndex - 1)))
                            </span>
                        }
                    </p>
                    <p>
                        <span class="infoLabel">Oxygen Saturation:</span>
                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                            @outputStringOrNA(vitalMap.get("oxygenSaturation", vitalMap.getDate(dateIndex - 1)))
                            </span>
                        }
                    </p>
                    <p>
                        <span class="infoLabel">Glucose:</span>
                        @for(dateIndex <- 1 to vitalMap.getDateListChronological.size) {
                            <span>
                            @outputStringOrNA(vitalMap.get("glucose", vitalMap.getDate(dateIndex - 1)))
                            </span>
                        }
                    </p>
                }
                </div>
            </div>


            <div class="encounterViewBodyHeader">
                <p>Assessment</p>
            </div>
            <div class="encounterViewBody">
                <div class="encounterViewBodyLeft">
                    @*Pmh and treatment tab fields are listed here*@
                    @defining(viewModelMedical.getPmhFields) { pmhFieldMap =>
                        <p><a class="infoLabel"> Medical/Surgical History:</a>
                            <span class="value"> @outputStringOrNA(pmhFieldMap.get("medicalSurgicalHistory"))</span> </p>
                        <p><a class="infoLabel"> Social History:</a>
                            <span class="value"> @outputStringOrNA(pmhFieldMap.get("socialHistory"))</span></p>
                        <p><a class="infoLabel">Current Medications:</a>
                            <span class="value"> @outputStringOrNA(pmhFieldMap.get("currentMedications"))</span></p>

                        <p><a class="infoLabel"> Family History: </a>
                            <span class="infoLabel"> @outputStringOrNA(pmhFieldMap.get("familyHistory"))</span></p>
                    }
                    @defining(viewModelMedical.getTreatmentFields) { treatmentFieldMap =>
                        <p><a  class="infoLabel"> Assessment: </a>
                            <span class="value"> @outputStringOrNA(treatmentFieldMap.get("assessment"))</span></p>

                        <p><a class="infoLabel">Treatment:</a>
                            <span class="value"> @outputStringOrNA(treatmentFieldMap.get("treatment"))</span></p>
                    }
                    @for(problemIterator <- 1 to viewModelPharmacy.getProblems.size){
                        <p><a class="infoLabel">Diagnosis:</a>
                            <span class="value">@outputStringOrNA(viewModelPharmacy.getProblems.get(problemIterator - 1))</span></p>
                    }
                    @for(prescriptionIterator <- 1 to viewModelPharmacy.getPrescriptions.size){
                        <p><a class = "infoLabel">Dispensed Medication:</a>
                            <span class="value"> @outputStringOrNA(viewModelPharmacy.getPrescriptions.get(prescriptionIterator - 1))</span></p>
                    }

                </div>
                <div class="encounterViewBodyMiddle">
                @if(viewModelMedical.isMultipleChiefComplaints) {
                    @for((key, value) <- viewModelMedical.getHpiFieldsWithMultipleChiefComplaints) {
                        <h4>Chief Complaint: @key</h4>
                        <p> <a class = "infoLabel">Onset:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("onset"))</span></p>

                        <p> <a class="infoLabel"> Quality: </a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("quality"))</span></p>
                        <p> <a class="infoLabel">Radiation:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("radiation"))</span></p>
                        <p> <a class="infoLabel">Severity:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("severity"))</span></p>
                        <p> <a class="infoLabel">Provokes:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("provokes"))</span></p>
                        <p> <a class="infoLabel">Palliates:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("palliates"))</span></p>

                        <p> <a class="infoLabel">Narrative:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("narrative"))</span></p>
                        <p> <a class="infoLabel">Time Of Day:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("timeOfDay"))</span></p>

                        <p> <a class="infoLabel">Physical Examination:</a>
                            <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithMultipleChiefComplaints.get(key).get("physicalExamination"))</span></p>


                        <br>
                    }
                } else {
                    @if(viewModel.getPatientEncounterItem.getChiefComplaints != null && viewModel.getPatientEncounterItem.getChiefComplaints.size > 0){<h4>Chief Complaint: @viewModel.getPatientEncounterItem.getChiefComplaints.get(0) </h4>}
                    <p> <a class= "infoLabel">Onset:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("onset"))</span></p>
                    <p> <a class= "infoLabel">Quality:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("quality"))</span></p>

                    <p> <a class= "infoLabel">Radiation:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("radiation"))</span></p>

                    <p> <a class= "infoLabel">Severity:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("severity"))</span></p>

                    <p> <a class= "infoLabel">Provokes:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("provokes"))</span></p>

                    <p> <a class= "infoLabel">Palliates:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("palliates"))</span></p>

                    <p> <a class= "infoLabel">Time Of Day:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("timeOfDay"))</span></p>
                    <p> <a class= "infoLabel">Narrative:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("narrative"))</span></p>

                    <p> <a class= "infoLabel">Physical Examination:</a>
                        <span class="value">@outputStringOrNA(viewModelMedical.getHpiFieldsWithoutMultipleChiefComplaints.get("physicalExamination"))</span></p>




                }


                </div>

                <div class="encounterViewBodyRight">
                    @*Custom tab fields are listed here*@
                    @for((key, value) <- viewModelMedical.getCustomFields) {
                        <p><span class="infoLabel">
                            @key:
                        </span>
                            @outputStringOrNA(viewModelMedical.getCustomFields.get(key))
                        </p>
                    }

                </div>
            </div>

            @if(viewModelMedical.getPhotos.size > 0) {
                <div class="encounterViewBodyHeader">
                    <p>Photos</p>
                </div>
                <div class="encounterViewBody">
                @for(x <- 1 to viewModelMedical.getPhotos.size) {
                    <img src="@viewModelMedical.getPhoto(x - 1).getImageUrl">
                    <p class="imageDescription">@viewModelMedical.getPhoto(x - 1).getImageDesc</p>
                }

                </div>
            }

            <div id="edit-form" >

                <p class="form-label"></p>
                <input type="text" class="form-control input-sm pull-left value" name="edit-value" onKeyPress="white_space(edit-value)" value=""/>
                <input type="hidden" name="edit-field-name" value="" />

                <button type="button" id="saveEncounterBtn" class="fButton">Save</button>
                <button type="button" id="cancelEncounterBtn" class="fButton">Cancel</button>
            </div>

        </div>

    }

